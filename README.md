This documentation guide you through the creation of templates for [Nanobench](https://github.com/peta-pico/nanobench) to publish RDF [nanopublications](http://nanopub.org). It has been built from a [tutorial to deploy Nanobench](https://d2s.semanticscience.org/blog/2020/04/13/usecase-nanopublication) using the [d2s](https://pypi.org/project/d2s/) tool.

Requirements:

* [Docker](https://www.docker.com/)
* [ORCID account](https://orcid.org)

> This documentation has been written using Linux and MacOS. It can be run on Windows but you will need to **make sure the file paths are correct**.

## Run Nanobench

[Nanobench](https://github.com/peta-pico/nanobench) can be run directly using `docker run`:

```shell
docker run -d --rm --name nanobench -p 37373:37373 \
  -v $(pwd)/workspace/.nanopub:/root/.nanopub \
  -e NANOBENCH_API_INSTANCES=http://grlc.np.dumontierlab.com/api/local/local/ http://grlc.nanopubs.lod.labs.vu.nl/api/local/local/ http://130.60.24.146:7881/api/local/local/ \
  nanopub/nanobench
```

> Access on http://localhost:37373

> See [official documentation for Docker](https://github.com/peta-pico/nanobench/blob/master/INSTALL-with-Docker.md).

## Complete your profile

It is required to complete your profile to get the `id_rsa` you will use to publish templates.

Follow the instructions provided by the [locally deployed Nanobench web UI](http://localhost:37373/) to complete your profile, and publish your first nanopublication:

* Provide your [ORCID](https://orcid.org) identifier. If you don't have one you can create an account at https://orcid.org.

* You will then be prompted to create you `Keys for Digital Signatures`. Those keys are stored in `workspace/.nanopub/id_rsa`
* To finish, [link your ORCID account](http://localhost:37373/orcidlinking) to prove you are the rightful owner (follow the [Nanobench web UI instructions](http://localhost:37373/orcidlinking))
  * Keep the URL generated for your first nanopublication. It should starts with `http://purl.org/np/`

## Create a new template

New templates are published as Nanopublications with the rdf:type `nt:AssertionTemplate`, where `nt:` is the prefix for https://w3id.org/np/o/ntemplate/

The nanopublication is defined in a file using the `trig` format (an extension of RDF `turtle` to be able to define graphs).

To create a new template you need to use [Nanopub-java](https://github.com/Nanopublication/nanopub-java) to publish the Nanopublication we defined in the `trig` file using the `id_rsa` file generated by Nanobench.

In the following documentation we will create a new template to **describe a dataset that has a publicly available SPARQL endpoint** as example.

### Define the template file

The SPARQL dataset template is defined in the [TRiG](https://en.wikipedia.org/wiki/TriG_(syntax)) format in the file [nanopub-template-sparql-dataset.trig](https://github.com/MaastrichtU-IDS/nanobench-templates/blob/master/nanopub-template-sparql-dataset.trig). The TRiG format is an extension of Turtle to be able to define graphs.

We will use the `nanopub-template-sparql-dataset.trig` file as example in this documentation.

We defined the template to let the user describe 4 properties:

* title
* description
* homepage
* SPARQL endpoint URL

Additionally the type `dcat:Dataset` is used to describe the generated entity.

### Publish the template

Copy the `id_rsa` key file generated by Nanobench  to your home

For example, if it is in the `workspace/` folder:

```shell
cp -r workspace/.nanopub ~/.nanopub
```

Sign the `nanopub-template-sparql-dataset.trig` in the current folder using [nanopub-java image from DockerHub](https://hub.docker.com/repository/docker/umids/nanopub-java):

```shell
docker run -it --rm -v ~/.nanopub:/root/.nanopub -v $(pwd):/data umids/nanopub-java sign /data/nanopub-template-sparql-dataset.trig
```

It should generate a `signed.nanopub-template-sparql-dataset.trig`, you can now publish it:

```shell
docker run -it --rm -v ~/.nanopub:/root/.nanopub -v $(pwd):/data umids/nanopub-java publish /data/signed.nanopub-template-sparql-dataset.trig
```

The template is now published! ðŸ“‹

Our template can now be used at http://localhost:37373/publish?22&template=http://purl.org/np/RAVF_WDsJRkRXXWgaJx5p9EnjLIguIv0-GqDlbfBtBPcQ 

You will need to restart Nanobench to see your template displayed in the http://localhost:37373/publish list.

See an example of a nanopub generated using this template to describe the Bio2RDF biomedical dataset: http://server.nanopubs.lod.labs.vu.nl/RAjqGxG3uPcnpa7RA1h-QiSnGZqRhnQNCboV4bl-Vj0m8 

Feel free to add more datasets or create new templates!

## Aknowledgments

* Tobias Kuhn